<!DOCTYPE HTML>
<html>
<head>
    <title>Pivoter Screenview</title>
    <link rel="stylesheet" type="text/css" media="all" href="style.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://pivoter.menmo.se:81/socket.io/socket.io.js"></script>
    <script type="text/javascript">
        var socket = io.connect('pivoter.menmo.se:81');
        socket.on('update', function (data) {
            if (data.status == 0) {
                socket.emit('get_stories');
                showpage('stories');
            }
            else if (data.status == 1) {
                $('.title').html(data.story.name[0]);
                $('.description').html(data.story.description[0].replace('\n', '<br/>'));
                $('.count').html(data.total + ' connected, ' + data.voted + ' voted');
                showpage('voting');
            }
            else if (data.status == 2) {
                showpage('results');
            }
        });
        socket.on('stories', function (data) {
            console.log(data);
            var list = $('#stories ul').empty();
            for (i in data.stories) {
                list.append($('<li>').append($('<a>', { href:'#', rel:i }).html(data.stories[i].name[0])));
            }
        });

        $('#stories ul a').live('click', function (e) {
            e.preventDefault();
            socket.emit('select_story', { story:this.rel });
        });

        $(function() {
            $('#voting a').click(function (e) {
                e.preventDefault();
                socket.emit('end_voting');
            });
        });

        function showpage(page) {
            $('.page').hide();
            $('#' + page).show();
        }
    </script>
</head>
<body>
<div id="stories" class="page">
    <div class="header">Pivoter</div>
    <ul></ul>
</div>
<div id="voting" class="page">
    <div class="header">Pivoter</div>
    <div class="title"></div>
    <div class="description"></div>
    <div class="info">
        <div class="count"></div>
        <a href="#" class="button">Results</a>
    </div>
</div>
<div id="results" class="page">
    <div class="header">Pivoter</div>
</div>
</body>
</html>