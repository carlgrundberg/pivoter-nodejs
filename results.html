<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Results</title>
    <script src="http://localhost:81/socket.io/socket.io.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script>
        var socket = io.connect('http://localhost:81');
        var voting_data;
        socket.on('voting_room_update', function (data) {
            voting_data = data;
            switch (data.status) {
                case 0:
                    draw_count();
                    break;
                case 1:
                    draw_results();
                    break;
            }
        });

        function draw_count() {
            $('#results').hide();
            $('#story').html(voting_data.story);
            $('#count').html(voting_data.voted + '/' + voting_data.total);
            $('#voting').show();
        }

        function draw_results() {
            $('#voting').hide();
            var c = $('#results table').empty();
            var rows = [0, 1, 2, 3, 5, 8, 13, 20, 40,100,1000,1001];
            if (voting_data) {
                var result_header = $('<tr>').append('<th>');
                var i = 1;
                for (j in voting_data.voters) {
                    result_header.append($('<th>').html(i++));
                }
                c.append(result_header);
                for (i in rows) {
                    var result_row = $('<tr>');
                    result_row.append($('<td>').html(rows[i]));
                    for (j in voting_data.voters) {
                        result_row.append($('<td>').html(voting_data.voters[j] == rows[i] ? 'X' : ''));
                    }
                    c.append(result_row);
                }
            }
            $('#results').show();
        }

        $(function () {
            $('#show_results').click(function (e) {
                e.preventDefault();
                socket.emit('end_vote');
            });
            $('#reset_voting').click(function (e) {
                e.preventDefault();
                socket.emit('start_vote');
            });
        });
    </script>
</head>
<body>
<h1 id="story"></h1>
<div id="voting" style="display: none;">
    <p id="count"></p>
    <a href="#" id="show_results">Show results</a>
</div>
<div id="results" style="display: none;">
    <table></table>
    <a href="#" id="reset_voting">Restart voting</a>
</div>
</body>
</html>
